{% extends 'base.html' %}
{% load humanize %}

{% block title %}Cierre de Turno â€” POS{% endblock %}

{% block content %}
<div class="card p-8 bg-surface-0 shadow-xl max-w-2xl w-full mx-auto animate-slide-up mt-6">
    <div class="text-center mb-8 border-b border-surface-100 pb-6">
        <h1 class="text-3xl font-bold text-surface-900">Cierre de Turno</h1>
        <p class="text-surface-500 mt-2">
            Caja: <span class="font-bold text-surface-800">{{ shift.register.name }}</span> |
            Apertura: <span class="font-bold text-surface-800">{{ shift.opened_at|date:"H:i" }}</span>
        </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
        <!-- System Data -->
        <div class="bg-surface-50 p-6 rounded-xl border border-surface-200">
            <h3 class="text-sm font-bold text-surface-400 uppercase tracking-wider mb-4">Datos del Sistema</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-surface-600">Fondo Inicial:</span>
                    <span class="font-mono font-bold text-surface-800">$ {{ shift.opening_amount|intcomma }}</span>
                </div>
                <!-- Calculate total cash expected (opening + sales cash) -->
                <!-- We assume the view passes 'expected_cash' or we calculate roughly here if not passed, 
                     but ideally the view should pass it. Using placeholders for better UI logic -->
                <div class="flex justify-between">
                    <span class="text-surface-600">Ventas Efeteivo:</span>
                    <span class="font-mono font-bold text-success-600">+ $ {{ cash_sales_total|default:"0"|intcomma }}</span>
                </div>
                <div class="flex justify-between pt-2 border-t border-surface-200">
                    <span class="text-surface-800 font-bold">Total Esperado:</span>
                    <span class="font-mono font-black text-brand-700 text-lg">$ {{ expected_cash|default:"0"|intcomma }}</span>
                </div>
            </div>
            <p class="text-xs text-surface-400 mt-4 italic">* Solo efectivo. Tarjetas y transferencias se cuadran por
                separado.</p>
        </div>

        <!-- User Input -->
        <div>
            <form method="post" action="{% url 'close_shift' %}">
                {% csrf_token %}
                <label for="closing_amount" class="block text-sm font-bold text-surface-700 mb-2">Efectivo Real en
                    Caja</label>
                <div class="relative rounded-md shadow-sm mb-4">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                        <span class="text-surface-500 text-lg font-bold">$</span>
                    </div>
                    <input type="number" name="closing_amount" id="closing_amount" required min="0"
                        class="block w-full rounded-lg border-surface-300 pl-8 py-4 focus:border-brand-500 focus:ring-brand-500 text-2xl font-bold bg-white text-surface-900 shadow-inner"
                        placeholder="0">
                </div>

                <div class="mb-6">
                    <label for="notes" class="block text-sm font-bold text-surface-700 mb-2">Notas /
                        Observaciones</label>
                    <textarea name="notes" id="notes" rows="3"
                        class="block w-full rounded-lg border-surface-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm resize-none"
                        placeholder="Diferencias, retiros, billetes rotos..."></textarea>
                </div>

                <button type="submit"
                    class="w-full btn-danger py-4 text-lg justify-center shadow-lg hover:translate-y-[-2px]">
                    Cerrar Turno e Imprimir Z
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}